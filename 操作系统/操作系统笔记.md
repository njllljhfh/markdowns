# 第一章、计算机系统漫游



## 1.1、信息就是位 + 上下文



## 1.2、程序被其他程序翻译成不同的格式

- 源文件（文本文件）

- 可执行目标文件（二进制磁盘文件）



### 1.2.1、编译系统（compilation system）编译的四个阶段：

1. 预处理阶段（预处理器cpp）：根据 `#` 开头的命令，修改原始的C程序，结果得到另一个C程序，通常以 `.i` 作为文件扩展名。
2. 编译阶段（编译器ccl）：将 `hello.i` 翻译成 `hello.s`，它包含一个汇编语言程序。
3. 汇编阶段（汇编器as）：将 `hello.i` 翻译成机器语言指令，并将结果保存在目标文件 `hello.o` 中。`hello.o` 文件是一个二进制文件。
4. 连接阶段（连接器ld）：`hello.o` 程序调用了 `printf` 函数，他是每个C编译器都提供的标准C库中的一个函数。`printf` 函数存在于一个名为 `printf.o` 的单独的预编译好了的目标文件中，而这个文件必须以莫衷方式合并到我们的 `hello.o` 程序中。连接器就负责处理这种合并。



### 1.2.2、GNU（GNU's Not Unix）项目

GCC是GNU项目开发出来的众多有用工具之一



## 1.3、了解编译系统如何工作是大有益处的



## 1.4、处理器读并解释存储在内存中的指令

- shell是一个命令行解释器



### 1.4.1、系统的硬件组成

p-42

- 总线

- I/O设备：
  - 每个I/O设备都通过一个控制器或适配器与I/O总线相连
    - 控制器（I/O设备本身或者系统的主印制电路板上的芯片组）
    - 适配器（是一块插在主板插槽上的卡）

- 主存：
  - 由一组 动态随机存取存储器（DRAM）芯片 组成。
  - 用来存放程序和程序处理的数据。

- 处理器（CPU）：
  - 寄存器：CPU的核心是一个大小为一个字的存储设备（寄存器），称为程序计数器（PC）。在任何时刻，PC都指向主存中的某条机器语言指令（即含有该条指令的地址）。
  - 寄存器文件（register file）：是一个小的存储设备，由一些单个字长的寄存器组成，每个寄存器都有唯一的名字。
  - 算数/逻辑单元（ALU）：
  - 指令集架构
  - 微体系结构



### 1.4.2、运行hello程序

- 直接存储器存取（DMA）技术（见第六章）



## 1.5、高速缓存至关重要

- 处理器从寄存器文件中读取数据比从主存中读取几乎要快100倍
- 加快处理器的运行速度比加快主存的运行速度要容易和便宜的多
- 高速缓存存储器（cache memory，简称为cache或高速缓存）
  - 静态随机访问存储器（SRAM）



## 1.6、存储设备形成层次结构

- 寄存器
  - L1高速缓存（SRAM）
    - L2高速缓存（SRAM）
      - L3高速缓存（SRAM）
        - 主存（DRAM）
          - 本地二级存储（本地磁盘）
            - 远程二级存储（分布式文件系统，Web服务器）



## 1.7、操作系统管理硬件

- 可以把操作系统看成是应用程序和硬件之间插入的一层软件
- 操作系统的两个基本功能：
  - 防止硬件被时空的应用程序滥用
  - 向应用程序提供肩带一直的机制来控制复杂而又通常大不相同的低级硬件设备
- 进程、虚拟内存、文件
  - `文件` 是对I/O设备的抽象表示
  - `虚拟内存` 是对主存和磁盘I/O设备的抽象表示
  - `进程` 是对处理器、主存和I/O设备的抽象表示

### 1.7.1、进程

- `并发运行` 是说一个进程的指令和另一个进程的指令是交错执行的。操作系统实现这种交错执的机制称为 `上下文切换`
- `上下文切换`：当操作系统决定要把控制权从当前进程转移到某个新进程时，就会进行上下文切换，即保存当前进程的上下文、恢复新进程的上下文，然后控制权传递到新进程。
- `内核` 是操作系统代码常驻主存的部分。
  - 注意，内核不是一个独立的进程。相反，它是系统管理全部进程所用代码和数据结构的集合。
- 系统调用：将控制权传递给内核

### 1.7.2、线程

- 每个线程都运行在进程的上下文中，并且共享同样的代码和全局数据。
- 线程一般来说都比进程更高效

### 1.7.3、虚拟内存

- 虚拟地址空间
  - 内核虚拟内存
  - 栈
  - 共享库
  - 堆
  - 程序代码和数据
- 虚拟内存的运作需要硬件和操作系统软件之间的精密复杂的交互，包括对处理器生成的每个地址的硬件翻译。基本思想是把一个进程的虚拟内存的内容存储在磁盘上，然后主存作为磁盘的高速缓存。

### 1.7.4、文件

- 文件就是字节序列。每个I/O设备，包括磁盘、键盘、显示器、甚至网络，都可以看成是文件。



## 1.8、系统之间利用网络通信

- 网络可视为一个I/O设备



## 1.9、重要主题

### 1.9.1、Amdahl定律



### 1.9.2、并发和并行

- 线程级并发
  - 超线程（有时称为同时多线程）：是一项允许一个CPU执行多个控制流的技术。
- 指令集并行
  - 超标量处理器
- 单指令、多数据并行（SIMD并行）



### 1.9.3、计算机系统中抽象的重要性





# 第二章、信息的表示和处理

## 2.1、信息存储

- 大多数计算机使用8位的块，或者字节(byte)，作为最小的可寻址的内存单位，而不是访问内存中单独的位
- `虚拟内存`：机器级程勋将内存视为一个非常大的字节数组，称为虚拟内存
  - `地址`：内存中每个字节都由一个唯一的数字来标识，称为它的地址。这个数字标识在32位的系统下是一个32位的整数，在64位的系统下是一个64位的整数。
  - `虚拟地址空间`：所有可能地址的集合

### 2.1.1、十六进制

### 2.1.2、字数据大小

- 32位程序和64位程序的区别是，程序是如何编译的，而不是其运行的机器类型
- 程序员应该力图使他们的程序在不同的机器和编译器上可移植。可移植性的一个方面就是使程序对不同数据类型的确切大小不敏感。

### 2.1.3、寻址和字节顺序





